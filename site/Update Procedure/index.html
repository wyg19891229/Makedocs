



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.2.0">
    
    
      
        <title>Change Log - Test</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.572ca0f0.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.8c900955.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#bcid-310-update-procedure" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Test" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Test
              </span>
              <span class="md-header-nav__topic">
                Change Log
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Test" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Test
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Change Log
      </label>
    
    <a href="./" title="Change Log" class="md-nav__link md-nav__link--active">
      Change Log
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deploy-admin-console-api-packages" title="Deploy Admin Console &amp; API Packages" class="md-nav__link">
    Deploy Admin Console &amp; API Packages
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deploy-admin-console-api-packages" title="Deploy Admin Console &amp; API Packages" class="md-nav__link">
    Deploy Admin Console &amp; API Packages
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="bcid-310-update-procedure">BCID 3.1.0 Update Procedure</h1>
<blockquote>
<p><em>Upgrading from BCID 3.0.2 to 3.1.0</em></p>
</blockquote>
<h2 id="deploy-admin-console-api-packages">Deploy Admin Console &amp; API Packages</h2>
<blockquote>
<p><em>IMPORTANT</em>: Make sure you run a BACKUP of your Database using SQL Server Management Studio before proceeding! Some changes to the DB structure cannot be undone. Relevant data will also be lost but regenerated when mobile devices reconnect.</p>
</blockquote>
<ol>
<li>Unpack API package to a new destination folder (e.g., <strong>“/bioconnect_n3.1.0”</strong>)</li>
</ol>
<pre><code>cd bioconnect_n/..
mkdir bioconnect_n3.1.0
cd bioconnect_n3.1.0
tar xf \&lt;release package tar\&gt;
</code></pre>

<blockquote>
<p><em>Note: Package unzips to ‘release’ in current directory so make sure not to overwrite the current release folder.</em></p>
</blockquote>
<ol>
<li>
<p>Confirm that <strong>release/config/database.yml</strong> and <strong>release/config/puma.rb</strong> in the new directory match the previous release or copy accordingly.</p>
</li>
<li>
<p><em>Puma bind URI needs to be appropriate for localhost connection from NGINX bind</em></p>
</li>
<li>
<p><em>Database config should inherit all settings from environment variables</em></p>
</li>
</ol>
<pre><code>cd app_path/../..
cp bioconnect_n/release/config/database.yml \\
bioconnect_n3.1.0/release/config/database.yml
cp bioconnect_n/release/config/puma.rb \\
bioconnect_n3.1.0/release/config/puma.rb
</code></pre>

<ol>
<li>
<p>Add environment variables for AWS:SNS to [.bashrc] and source it to the current shell</p>
<p><em>3.1.  Open the <strong>.bashrc</strong> in vi editor</em>
<code>vi \~/.bashrc</code></p>
<p><em>3.2.  Add these lines to the export section</em>
<code>export BC_AWS_CRED_ID={to be provided}</code>
<code>export BC_AWS_CRED_KEY={to be provided}</code></p>
<p><em>3.3. Save/exit the vi editor</em>
<code>:wq</code></p>
<p><em>3.4.  Source the <strong>.bashrc</strong> to the current shell</em>
<code>source \~/.bashrc</code></p>
</li>
<li>
<p>Navigate to the new release directory</p>
</li>
</ol>
<pre><code>cd bioconnect_n3.1.0/release
</code></pre>

<ol>
<li>Run bundler to install dependencies</li>
</ol>
<pre><code>bundle install
</code></pre>

<ol>
<li>Make sure proxy settings and added credentials are valid</li>
</ol>
<pre><code>bundle exec rails bc:utility:test_aws
</code></pre>

<ol>
<li>Verify migration status and confirm migrations that are currently down</li>
</ol>
<pre><code>bundle exec rails db:migrate:status
</code></pre>

<p><strong>We would expect the following migrations to be down</strong></p>
<pre><code>down    20171120174030  Delete system admin
down    20171121185738  Sns application authenticator association
down    20171121191437  Remove notification service id from authenticator
down    20180115181453  Add match score to user verification
down    20180123154240  Add resolved at time stamp to user verification
</code></pre>

<ol>
<li>Identify Puma process ID and kill the process</li>
</ol>
<pre><code>ps -efH \| grep puma
kill {pid}
</code></pre>

<blockquote>
<p><em>IMPORTANT</em>: At this point you must have completed your database backup or you will lose the opportunity to do so after this step.</p>
</blockquote>
<ol>
<li>Update the database schema</li>
</ol>
<pre><code>bundle exec rails db:migrate
</code></pre>

<blockquote>
<p><em>Note: This reports changes that it makes to the database</em></p>
</blockquote>
<ol>
<li>Start the Puma process</li>
</ol>
<pre><code>bundle exec puma -d -C config/puma.rb
</code></pre>

<ol>
<li>Backup HTTP folder</li>
</ol>
<pre><code>mkdir \~/admin_console3.0.1
cp -r /var/www/html/\* \~/admin_console3.0.1
cd /var/www/html/
tar xf admin_console
</code></pre>

<ol>
<li>Configure the {endpoint_url} by editing <strong>\&lt;bundle.js></strong></li>
</ol>
<pre><code>sudo vi /var/www/html/bundle.js
</code></pre>

<ol>
<li>Type "/endpoint_url" to find the appropriate location in the file and edit the string between the quotation marks</li>
</ol>
<blockquote>
<p><em>Note: NGINX should NOT require a restart after making the change.</em></p>
</blockquote>
<ol>
<li>Perform a step-up scenario action with a push notification to test that the system is working as intended.</li>
</ol>
<!--stackedit_data:
eyJoaXN0b3J5IjpbMTY0Nzg0NjI0XX0=
-->
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Home" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b41f3d20.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>